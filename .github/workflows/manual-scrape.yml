name: ğŸ¯ Manual Scrape

on:
  workflow_dispatch:
    inputs:
      category:
        description: 'Single category to scrape'
        required: true
        default: 'furniture'
        type: choice
        options:
          - furniture
          - lighting
          - decoration
          - decoration/vases
          - art
          - style/vintage
          - style/mid-century-modern
          - style/scandinavian
          - furniture/chairs
          - furniture/sofas
          - lighting/pendant-lamps

jobs:
  scrape-single:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4
      
    - name: ğŸ Set up Python  
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        cache: 'pip'
        
    - name: ğŸ“¦ Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: ğŸ” Scrape category: ${{ github.event.inputs.category }}
      run: |
        echo "ğŸ” Scraping category: ${{ github.event.inputs.category }}"
        python scrape_category.py "${{ github.event.inputs.category }}"
        
    - name: ğŸ“Š Show results
      run: |
        category="${{ github.event.inputs.category }}"
        filename="${category//\//_}_content.json"
        
        if [ -f "$filename" ]; then
          echo "âœ… Successfully scraped: $category"
          echo "ğŸ“ File: $filename"
          echo "ğŸ“Š File size: $(ls -lh $filename | awk '{print $5}')"
          
          # Show content summary
          python -c "
import json
with open('$filename', 'r') as f:
    data = json.load(f)
    
print(f'ğŸ“‹ Title: {data.get(\"page_title\", \"N/A\")}')
print(f'ğŸ“‘ Headings: {len(data.get(\"section_headings\", []))}')
print(f'ğŸ“ Description length: {len(data.get(\"category_description\", \"\"))} chars')
print(f'ğŸ” SEO content length: {len(data.get(\"seo_content\", \"\"))} chars')

if data.get('section_headings'):
    print('\\nğŸ¯ Section headings:')
    for i, heading in enumerate(data['section_headings'][:5], 1):
        print(f'  {i}. {heading}')
"
        else
          echo "âŒ No output file found"
          exit 1
        fi
        
    - name: ğŸ“ Upload result
      uses: actions/upload-artifact@v3
      with:
        name: ${{ github.event.inputs.category }}-content
        path: ${{ github.event.inputs.category }}_content.json
        retention-days: 7